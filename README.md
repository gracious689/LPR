# License Plate Recognition (LPR) System

A comprehensive License Plate Recognition system that detects license plates from images or live camera feeds and stores the results in a Supabase database.

## Features

- **Multiple Detection Methods**: Uses both cascade classifiers and contour-based detection
- **OCR Integration**: Utilizes Tesseract OCR for accurate plate number extraction
- **Supabase Storage**: Stores detected plates with timestamps and metadata in the cloud
- **Live Camera Processing**: Real-time license plate detection from video streams
- **Batch Processing**: Process multiple images from folders
- **Duplicate Prevention**: Intelligent duplicate detection to avoid database spam

## Requirements

### Software Dependencies
- Python 3.7+
- Supabase Account
- Tesseract OCR

### Python Packages
Install the required packages using:
```bash
pip install -r requirements.txt
```

## Installation

### 1. Create Supabase Project
1. Go to [supabase.com](https://supabase.com) and create a new project
2. Navigate to your project settings
3. Copy your Project URL and Anon Key

### 2. Install Tesseract OCR
- **Windows**: Download from [Tesseract at UB Mannheim](https://github.com/UB-Mannheim/tesseract/wiki)
- **Ubuntu/Debian**: `sudo apt-get install tesseract-ocr`
- **macOS**: `brew install tesseract`

### 3. Configure Environment
Edit the `.env` file with your Supabase credentials:
```env
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_KEY=your_supabase_anon_key
TESSERACT_PATH=C:\Program Files\Tesseract-OCR\tesseract.exe
```

### 4. Initialize Database Table
```bash
python main.py --mode setup
```
This will generate the SQL needed to create the table. Run the provided SQL in your Supabase SQL editor.

## Usage

### Process Single Image
```bash
python main.py --mode image --input path/to/image.jpg
```

### Process Image Folder
```bash
python main.py --mode folder --input path/to/images/
```

### Live Camera Detection
```bash
python main.py --mode camera --camera 0 --location "Main Entrance"
```

### View Recent Records
```bash
python main.py --mode records --limit 20
```

## Command Line Options

- `--mode`: Operation mode (setup, image, folder, camera, records)
- `--input`: Input file/folder path (required for image/folder modes)
- `--camera`: Camera index (default: 0)
- `--location`: Camera location identifier (default: "Main Entrance")
- `--limit`: Number of records to display (default: 10)

## Database Schema

The system creates a `license_plates` table with the following structure:

```sql
CREATE TABLE license_plates (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    plate_number VARCHAR(20) NOT NULL,
    timestamp TIMESTAMPTZ DEFAULT NOW(),
    confidence_score FLOAT,
    image_path VARCHAR(255),
    camera_location VARCHAR(100)
);

-- Create indexes for better performance
CREATE INDEX idx_plate_number ON license_plates(plate_number);
CREATE INDEX idx_timestamp ON license_plates(timestamp);
```

## Project Structure

```
LPR/
├── main.py              # Main application entry point
├── lpr_system.py        # Core LPR system logic
├── plate_detector.py    # License plate detection and OCR
├── supabase_manager.py  # Supabase database operations
├── supabase_setup.py    # Supabase initialization
├── requirements.txt     # Python dependencies
├── .env                # Environment configuration
└── README.md           # This file
```

## How It Works

1. **Image Preprocessing**: Converts images to grayscale, applies filters and edge detection
2. **Plate Detection**: Uses cascade classifiers and contour analysis to locate license plates
3. **OCR Processing**: Extracts text from detected plate regions using Tesseract
4. **Cloud Storage**: Saves detected plates with metadata to Supabase
5. **Duplicate Prevention**: Implements time-based duplicate detection

## Supabase Setup Instructions

1. **Create Project**: Sign up at Supabase and create a new project
2. **Get Credentials**: Copy Project URL and Anon Key from project settings
3. **Create Table**: Run the setup command and execute the generated SQL in Supabase SQL Editor
4. **Configure .env**: Add your Supabase credentials to the `.env` file

## Troubleshooting

### Common Issues

1. **Tesseract not found**: Ensure Tesseract is installed and path is correct in `.env`
2. **Supabase connection failed**: Check URL and API key in `.env`
3. **Table doesn't exist**: Run setup mode and execute SQL in Supabase SQL Editor
4. **No plates detected**: Try different lighting conditions or image quality
5. **Camera not accessible**: Verify camera index and permissions

### Performance Tips

- For better accuracy, ensure good lighting and clear images
- The system processes every 10th frame in live mode for performance
- Adjust duplicate detection timeout (30 seconds default) as needed
- Supabase provides real-time updates and automatic scaling

## License

This project is provided as-is for educational and development purposes.
